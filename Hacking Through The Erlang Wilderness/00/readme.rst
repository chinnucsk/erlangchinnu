=================================================
Hacking Through The Erlang Wilderness
=================================================

.. footer:: Copyright (c) 2011 Todd D. Greenwood-Geer 

:Authors: Todd D. Greenwood-Geer, Sean Jensen-Grey
:Date: Tue March 14 2011
:Version: 0.1
:Index: Index_ : Listing of all the episodes

-------------------------------------------
Create a VMware VM for Playing with Erlang
-------------------------------------------

Download
--------

1. Download the guest OS, in this example ubuntu 10.04 server

Base Install
------------

2. Install guest os in VMware host

Create a VM image based on an ubuntu distro.

.. image:: https://github.com/ToddG/experimental/raw/master/erlang/wilderness/00/images/screen1.png
    :height: 500px
    :align: center

Use easy install to create your user account and automatically configure various params.

.. image:: https://github.com/ToddG/experimental/raw/master/erlang/wilderness/00/images/screen2.png
    :height: 500px
    :align: center

Here's the vm configuration, ready to start building.

.. image:: https://github.com/ToddG/experimental/raw/master/erlang/wilderness/00/images/screen3.png
    :height: 500px
    :align: center

Ubuntu server is now installing.

.. image:: https://github.com/ToddG/experimental/raw/master/erlang/wilderness/00/images/screen4.png
    :height: 500px
    :align: center

Ubuntu server install complete.

.. image:: https://github.com/ToddG/experimental/raw/master/erlang/wilderness/00/images/screen5.png
    :height: 500px
    :align: center


Update Packages
---------------
.. TODO: verify that setting the guest to use Bridged Networking is necessary.

0. I configured the guest os to use Bridged networking for this phase, so that I could easily update the virtual machine packages. Later, I set it back to NAT.

1. Update the guest os::

    user@ubuntu$ sudo apt-get update
    user@ubuntu$ sudo apt-get upgrade

2. Install openssl-server so we can ssh into the server::

    user@ubuntu$ sudo apt-get install openssh-server


Configure Network
-----------------

See http://www.thirdbit.net/articles/2008/03/04/dhcp-on-vmware-fusion/

1. Get the mac address::

   $ user@ubuntu:$ ifconfig | grep eth0

.. image:: https://github.com/ToddG/experimental/tree/master/erlang/wilderness/00/images/screen6.png
    :align: center

2. Edit the host's vmware dhcpd.conf file::

    host$ sudo vim /Library/Application\ Support/VMware\ Fusion/vmnet8/dhcpd.conf

    1 # Configuration file for ISC 2.0 vmnet-dhcpd operating on vmnet8.
    2 #
    3 # This file was automatically generated by the VMware configuration program.
    4 # See Instructions below if you want to modify it.
    5 #
    6 # We set domain-name-servers to make some DHCP clients happy
    7 # (dhclient as configured in SuSE, TurboLinux, etc.).
    8 # We also supply a domain name to make pump (Red Hat 6.x) happy.
    9 #
    10 
    11 
    12 ###### VMNET DHCP Configuration. Start of "DO NOT MODIFY SECTION" #####
    13 # Modification Instructions: This section of the configuration file contains
    14 # information generated by the configuration program. Do not modify this
    15 # section.
    16 # You are free to modify everything else. Also, this section must start 
    17 # on a new line 
    18 # This file will get backed up with a different name in the same directory 
    19 # if this section is edited and you try to configure DHCP again.
    20 
    21 # Written at: 12/21/2010 18:17:07
    22 allow unknown-clients;
    23 default-lease-time 1800;                # default is 30 minutes
    24 max-lease-time 7200;                    # default is 2 hours
    25 
    26 subnet 192.168.87.0 netmask 255.255.255.0 {
    27     range 192.168.87.128 192.168.87.254;
    28     option broadcast-address 192.168.87.255;
    29     option domain-name-servers 192.168.87.2;
    30     option domain-name localdomain;
    31     default-lease-time 1800;                # default is 30 minutes
    32     max-lease-time 7200;                    # default is 2 hours
    33     option routers 192.168.87.2;
    34 }
    35 host vmnet8 {
    36     hardware ethernet 00:50:56:C0:00:08;
    37     fixed-address 192.168.87.1;
    38     option domain-name-servers 0.0.0.0;
    39     option domain-name "";
    40     option routers 0.0.0.0;
    41 }
    42 ####### VMNET DHCP Configuration. End of "DO NOT MODIFY SECTION" #######


3. Insert an entry for the vmware guest in the host's dhcpd.conf::

    42 ####### VMNET DHCP Configuration. End of "DO NOT MODIFY SECTION" #######
    43 
    44 # ubuntu32-10.04-server
    45 host ubuntu32 {
    46     hardware ethernet 00:0C:29:0F:98:2C;
    47     fixed-address 192.168.87.10;
    48 }   
    
4. Restart vmware on the host::

    host:~ todd$ sudo "/Library/Application Support/VMware Fusion/boot.sh" --restart
    Password:
    VMware Fusion 332101: Shutting down VMware Fusion: 
    Stopped DHCP service on vmnet1
    Disabled hostonly virtual adapter on vmnet1
    Stopped DHCP service on vmnet8
    Stopped NAT service on vmnet8
    Disabled hostonly virtual adapter on vmnet8
    Stopped all configured services on all networks
    No matching processes were found
    No matching processes were found
    No matching processes were found
    No matching processes were found
    No matching processes were found
    No matching processes were found
    (kernel) Kext com.vmware.kext.vmcrosstalk not found for unload request.
    Failed to unload com.vmware.kext.vmcrosstalk - (libkern/kext) not found.
    (kernel) Kext com.vmware.kext.vmmon not found for unload request.
    Failed to unload com.vmware.kext.vmmon - (libkern/kext) not found.
    Failed to unload com.vmware.kext.vmx86 - (iokit/common) unsupported function.
    (kernel) Kext com.vmware.kext.vmci did not stop (return code 0x5).
    (kernel) Kext com.vmware.kext.vmci can't unload - module stop returned 0xdc008017.
    Failed to unload com.vmware.kext.vmci - (libkern/kext) kext (kmod) start/stop routine failed.
    (kernel) Can't unload kext com.vmware.kext.vmioplug; classes have instances:
    (kernel)     Kext com.vmware.kext.vmioplug class com_vmware_kext_UsbPortArbiter has 1 instance.
    (kernel)     Kext com.vmware.kext.vmioplug class com_vmware_kext_UsbPortArbiterUserClient has 1 instance.
    Failed to unload com.vmware.kext.vmioplug - (libkern/kext) kext is in use or retained (cannot unload).
    (kernel) Kext com.vmware.kext.vmnet did not stop (return code 0x5).
    (kernel) Kext com.vmware.kext.vmnet can't unload - module stop returned 0xdc008017.
    Failed to unload com.vmware.kext.vmnet - (libkern/kext) kext (kmod) start/stop routine failed.

    VMware Fusion 332101: Starting VMware Fusion: 
    Verifying files from package 'com.vmware.fusion.application' on '/'.
    Finished verifying files from package 'com.vmware.fusion.application' on '/'.
    Started network services
    Verifying and re-installing files from /Library/Application Support/VMware Fusion/thnuclnt

5. Stop the guest vm and configure it to use NAT networking.

.. image:: https://github.com/ToddG/experimental/tree/master/erlang/wilderness/00/images/screen7.png
    :align: center

6. Start the guest vm

7. Try ssh'ing into the guest vm now::

    $ ssh user@192.168.87.10

    greenmachine:~ todd$ ssh user@192.168.87.10
    The authenticity of host '192.168.87.10 (192.168.87.10)' can't be established.
    RSA key fingerprint is fc:df:00:78:91:ba:89:14:d0:0b:48:12:f5:82:7c:80.
    Are you sure you want to continue connecting (yes/no)? yes
    Warning: Permanently added '192.168.87.10' (RSA) to the list of known hosts.
    user@192.168.87.10's password: 
    Linux ubuntu 2.6.32-24-generic #43-Ubuntu SMP Thu Sep 16 14:17:33 UTC 2010 i686 GNU/Linux
    Ubuntu 10.04.2 LTS

    Welcome to Ubuntu!
     * Documentation:  https://help.ubuntu.com/
    Last login: Tue Mar 15 18:44:36 2011
    user@ubuntu:~$ 

Done
----
This vm should be ready to play with now. Rinse and repeat as nec.


.. _Index: https://github.com/ToddG/experimental/tree/master/erlang/wilderness
